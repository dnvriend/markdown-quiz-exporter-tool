<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math and Economics Quiz</title>
    <script>
        tailwind = {
            config: {
                darkMode: 'class'
            }
        };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css" media="(prefers-color-scheme: dark)">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css" media="(prefers-color-scheme: light)">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script>
    <style>
        /* Smooth transitions */
        * {
            transition-property: color, background-color, border-color;
            transition-duration: 200ms;
        }

        /* Progress bar animation */
        .progress-bar {
            transition: width 300ms ease-in-out;
        }

        /* Custom scrollbar for dark mode */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgb(31 41 55);
        }

        ::-webkit-scrollbar-thumb {
            background: rgb(75 85 99);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgb(107 114 128);
        }

        /* Focus visible for accessibility */
        button:focus-visible,
        input:focus-visible {
            outline: 2px solid rgb(59 130 246);
            outline-offset: 2px;
        }

        /* Code block styling */
        pre {
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-x: auto;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Light mode code blocks */
        pre code.hljs {
            background: #f6f8fa;
            color: #24292e;
        }

        /* Dark mode code blocks */
        .dark pre code.hljs {
            background: #0d1117;
            color: #c9d1d9;
        }

        /* Inline code styling */
        :not(pre) > code {
            background: #f6f8fa;
            color: #24292e;
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-size: 0.875em;
        }

        .dark :not(pre) > code {
            background: #30363d;
            color: #c9d1d9;
        }

        /* Reset font-weight for code blocks inside bold containers */
        pre, pre code, code.hljs {
            font-weight: normal !important;
        }

        /* Bold question text styling */
        .bold-questions {
            font-weight: 700;
        }
        .bold-questions pre,
        .bold-questions code {
            font-weight: normal !important;
        }

        /* Prose paragraph spacing - override Tailwind reset */
        .prose p {
            margin-top: 1em;
            margin-bottom: 1em;
        }
        .prose p:first-child {
            margin-top: 0;
        }
        .prose p:last-child {
            margin-bottom: 0;
        }

        /* List spacing in prose */
        .prose ul, .prose ol {
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            padding-left: 1.5em;
        }
        .prose ul {
            list-style-type: disc !important;
        }
        .prose ol {
            list-style-type: decimal !important;
        }
        .prose li {
            margin-top: 0.25em;
            margin-bottom: 0.25em;
            display: list-item !important;
        }

        /* Links in prose */
        .prose a {
            color: #3b82f6;
            text-decoration: underline;
        }
        .prose a:hover {
            color: #2563eb;
        }
        .dark .prose a {
            color: #60a5fa;
        }
        .dark .prose a:hover {
            color: #93c5fd;
        }

        /* KaTeX dark mode support */
        .dark .katex {
            color: #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- App container -->
    <div id="app" class="container mx-auto px-4 py-8 max-w-4xl"></div>

    <!-- Quiz data -->
    <script>
        const QUIZ_DATA = {"title":"Math and Economics Quiz","questions":[{"category":"","text":"What is the formula for the circumference of a circle with radius $r$?","type":"single","answers":[{"text":"$C = \\pi r$","correct":false},{"text":"$C = 2\\pi r$","correct":true},{"text":"$C = \\pi r^2$","correct":false},{"text":"$C = 2\\pi r^2$","correct":false}],"reason":"The circumference is the distance around a circle. It equals the diameter ($2r$) multiplied by $\\pi$:\n$$C = 2\\pi r$$"},{"category":"","text":"What is the area of a circle with radius $r$?","type":"single","answers":[{"text":"$A = 2\\pi r$","correct":false},{"text":"$A = \\pi r$","correct":false},{"text":"$A = \\pi r^2$","correct":true},{"text":"$A = 2\\pi r^2$","correct":false}],"reason":"The area of a circle is:\n$$A = \\pi r^2$$\n\nFor example, a circle with $r = 3$ has area $A = \\pi \\cdot 9 = 9\\pi \\approx 28.27$ square units."},{"category":"","text":"In a right triangle, if $\\theta$ is an angle, what does $\\sin(\\theta)$ equal?","type":"single","answers":[{"text":"$\\frac{\\text{adjacent}}{\\text{hypotenuse}}$","correct":false},{"text":"$\\frac{\\text{opposite}}{\\text{hypotenuse}}$","correct":true},{"text":"$\\frac{\\text{opposite}}{\\text{adjacent}}$","correct":false},{"text":"$\\frac{\\text{hypotenuse}}{\\text{opposite}}$","correct":false}],"reason":"The sine function is defined as:\n$$\\sin(\\theta) = \\frac{\\text{opposite}}{\\text{hypotenuse}}$$\n\nRemember SOH-CAH-TOA:\n- **S**ine = **O**pposite / **H**ypotenuse\n- **C**osine = **A**djacent / **H**ypotenuse\n- **T**angent = **O**pposite / **A**djacent"},{"category":"","text":"What is the value of $\\sin^2(\\theta) + \\cos^2(\\theta)$?","type":"single","answers":[{"text":"$0$","correct":false},{"text":"$1$","correct":true},{"text":"$2$","correct":false},{"text":"$\\tan(\\theta)$","correct":false}],"reason":"This is the **Pythagorean identity**, one of the fundamental trigonometric identities:\n$$\\sin^2(\\theta) + \\cos^2(\\theta) = 1$$\n\nThis follows from the Pythagorean theorem applied to a unit circle."},{"category":"","text":"What is $\\tan(\\theta)$ expressed in terms of sine and cosine?","type":"single","answers":[{"text":"$\\frac{\\cos(\\theta)}{\\sin(\\theta)}$","correct":false},{"text":"$\\frac{\\sin(\\theta)}{\\cos(\\theta)}$","correct":true},{"text":"$\\sin(\\theta) \\cdot \\cos(\\theta)$","correct":false},{"text":"$\\sin(\\theta) + \\cos(\\theta)$","correct":false}],"reason":"The tangent is the ratio of sine to cosine:\n$$\\tan(\\theta) = \\frac{\\sin(\\theta)}{\\cos(\\theta)}$$"},{"category":"","text":"What is the derivative of $f(x) = x^3$?","type":"single","answers":[{"text":"$f'(x) = x^2$","correct":false},{"text":"$f'(x) = 3x^2$","correct":true},{"text":"$f'(x) = 3x^3$","correct":false},{"text":"$f'(x) = x^4$","correct":false}],"reason":"Using the power rule $\\frac{d}{dx}x^n = nx^{n-1}$:\n$$\\frac{d}{dx}x^3 = 3x^{3-1} = 3x^2$$"},{"category":"","text":"What is $\\int x^2 \\, dx$?","type":"single","answers":[{"text":"$\\frac{x^3}{3} + C$","correct":true},{"text":"$2x + C$","correct":false},{"text":"$x^3 + C$","correct":false},{"text":"$\\frac{x^2}{2} + C$","correct":false}],"reason":"The power rule for integration states $\\int x^n \\, dx = \\frac{x^{n+1}}{n+1} + C$:\n$$\\int x^2 \\, dx = \\frac{x^{2+1}}{2+1} + C = \\frac{x^3}{3} + C$$"},{"category":"","text":"Evaluate the definite integral $\\int_0^2 x \\, dx$.","type":"single","answers":[{"text":"$1$","correct":false},{"text":"$2$","correct":true},{"text":"$4$","correct":false},{"text":"$0$","correct":false}],"reason":"First find the antiderivative, then apply the limits:\n$$\\int_0^2 x \\, dx = \\left[\\frac{x^2}{2}\\right]_0^2 = \\frac{2^2}{2} - \\frac{0^2}{2} = \\frac{4}{2} - 0 = 2$$"},{"category":"","text":"What is the formula for compound interest, where $P$ is principal, $r$ is annual rate, $n$ is compounding frequency, and $t$ is time in years?","type":"single","answers":[{"text":"$A = P(1 + rt)$","correct":false},{"text":"$A = P\\left(1 + \\frac{r}{n}\\right)^{nt}$","correct":true},{"text":"$A = Pe^{rt}$","correct":false},{"text":"$A = P + Prt$","correct":false}],"reason":"The compound interest formula is:\n$$A = P\\left(1 + \\frac{r}{n}\\right)^{nt}$$\n\nWhere:\n- $A$ = final amount\n- $P$ = principal (initial investment)\n- $r$ = annual interest rate (decimal)\n- $n$ = number of times compounded per year\n- $t$ = time in years"},{"category":"","text":"What is the Present Value (PV) formula for a future cash flow $FV$ discounted at rate $r$ over $n$ periods?","type":"single","answers":[{"text":"$PV = FV \\times (1 + r)^n$","correct":false},{"text":"$PV = \\frac{FV}{(1 + r)^n}$","correct":true},{"text":"$PV = FV \\times r \\times n$","correct":false},{"text":"$PV = FV - (r \\times n)$","correct":false}],"reason":"The present value discounts future money back to today:\n$$PV = \\frac{FV}{(1 + r)^n}$$\n\nThis reflects the **time value of money**: ‚Ç¨100 today is worth more than ‚Ç¨100 in the future."},{"category":"","text":"The Net Present Value (NPV) formula is $NPV = \\sum_{t=0}^{n} \\frac{CF_t}{(1 + r)^t}$. If initial investment is ‚Ç¨1000 and you receive ‚Ç¨600 in year 1 and ‚Ç¨600 in year 2 at $r = 10\\%$, what is the NPV?","type":"single","answers":[{"text":"‚Ç¨-100","correct":false},{"text":"‚Ç¨41.32","correct":true},{"text":"‚Ç¨200","correct":false},{"text":"‚Ç¨1200","correct":false}],"reason":"Calculate each term:\n$$\\begin{aligned}\nNPV &= \\frac{-1000}{(1.1)^0} + \\frac{600}{(1.1)^1} + \\frac{600}{(1.1)^2} \\\\\n&= -1000 + 545.45 + 495.87 \\\\\n&= 41.32\n\\end{aligned}$$\n\nSince $NPV > 0$, this is a profitable investment."},{"category":"","text":"What is the formula for Return on Investment (ROI)?","type":"single","answers":[{"text":"$ROI = \\frac{\\text{Revenue}}{\\text{Cost}} \\times 100\\%$","correct":false},{"text":"$ROI = \\frac{\\text{Gain} - \\text{Cost}}{\\text{Cost}} \\times 100\\%$","correct":true},{"text":"$ROI = \\frac{\\text{Cost}}{\\text{Gain}} \\times 100\\%$","correct":false},{"text":"$ROI = \\text{Gain} - \\text{Cost}$","correct":false}],"reason":"ROI measures the return relative to the investment cost:\n$$ROI = \\frac{\\text{Gain} - \\text{Cost}}{\\text{Cost}} \\times 100\\%$$\n\nOr equivalently: $ROI = \\frac{\\text{Net Profit}}{\\text{Cost}} \\times 100\\%$"},{"category":"","text":"The price elasticity of demand $E_d$ measures how quantity demanded responds to price changes. What is the formula?","type":"single","answers":[{"text":"$E_d = \\frac{\\Delta P}{\\Delta Q}$","correct":false},{"text":"$E_d = \\frac{\\%\\Delta Q_d}{\\%\\Delta P}$","correct":true},{"text":"$E_d = \\frac{P}{Q}$","correct":false},{"text":"$E_d = Q \\times P$","correct":false}],"reason":"Price elasticity of demand is:\n$$E_d = \\frac{\\%\\Delta Q_d}{\\%\\Delta P} = \\frac{\\frac{\\Delta Q}{Q}}{\\frac{\\Delta P}{P}}$$\n\n- If $|E_d| > 1$: **elastic** demand (sensitive to price)\n- If $|E_d| < 1$: **inelastic** demand (insensitive to price)\n- If $|E_d| = 1$: **unit elastic**"},{"category":"","text":"In economics, the profit maximization condition for a firm is:","type":"single","answers":[{"text":"$MR = MC$","correct":true},{"text":"$MR > MC$","correct":false},{"text":"$TR = TC$","correct":false},{"text":"$AR = AC$","correct":false}],"reason":"A firm maximizes profit where **Marginal Revenue equals Marginal Cost**:\n$$MR = MC$$\n\nAt this point:\n- If $MR > MC$: producing more increases profit\n- If $MR < MC$: producing less increases profit\n- If $MR = MC$: profit is maximized"},{"category":"","text":"The Break-Even Point (BEP) in units is calculated as:","type":"single","answers":[{"text":"$BEP = \\frac{FC}{P}$","correct":false},{"text":"$BEP = \\frac{FC}{P - VC}$","correct":true},{"text":"$BEP = \\frac{VC}{P - FC}$","correct":false},{"text":"$BEP = FC + VC$","correct":false}],"reason":"The break-even point is where total revenue equals total cost:\n$$BEP = \\frac{FC}{P - VC}$$\n\nWhere:\n- $FC$ = Fixed Costs\n- $P$ = Price per unit\n- $VC$ = Variable Cost per unit\n- $P - VC$ = **Contribution Margin** per unit"},{"category":"","text":"What is the quadratic formula to solve $ax^2 + bx + c = 0$?","type":"single","answers":[{"text":"$x = \\frac{-b \\pm \\sqrt{b^2 + 4ac}}{2a}$","correct":false},{"text":"$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$","correct":true},{"text":"$x = \\frac{b \\pm \\sqrt{b^2 - 4ac}}{2a}$","correct":false},{"text":"$x = \\frac{-b \\pm \\sqrt{b - 4ac}}{a}$","correct":false}],"reason":"The quadratic formula is:\n$$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$$\n\nThe **discriminant** $D = b^2 - 4ac$ determines the nature of solutions:\n- $D > 0$: two real solutions\n- $D = 0$: one real solution\n- $D < 0$: no real solutions (complex roots)"},{"category":"","text":"What is the derivative of $e^x$?","type":"single","answers":[{"text":"$xe^{x-1}$","correct":false},{"text":"$e^x$","correct":true},{"text":"$\\ln(x)$","correct":false},{"text":"$e^{x-1}$","correct":false}],"reason":"The exponential function $e^x$ is its own derivative:\n$$\\frac{d}{dx}e^x = e^x$$\n\nThis is one of the special properties of the number $e \\approx 2.71828$."},{"category":"","text":"What is $\\int e^x \\, dx$?","type":"single","answers":[{"text":"$xe^x + C$","correct":false},{"text":"$e^x + C$","correct":true},{"text":"$\\frac{e^x}{x} + C$","correct":false},{"text":"$e^{x+1} + C$","correct":false}],"reason":"Since the derivative of $e^x$ is $e^x$, the integral is:\n$$\\int e^x \\, dx = e^x + C$$"},{"category":"","text":"In CAPM, the formula is $E(R_i) = R_f + \\beta_i(E(R_m) - R_f)$. What does $\\beta_i$ represent?","type":"single","answers":[{"text":"The risk-free rate","correct":false},{"text":"The market return","correct":false},{"text":"The systematic risk of asset $i$ relative to the market","correct":true},{"text":"The total return of asset $i$","correct":false}],"reason":"In the **CAPM** (Capital Asset Pricing Model) formula:\n- $R_f$ = risk-free rate\n- $E(R_m)$ = expected market return\n- $\\beta_i$ = beta coefficient, measuring **systematic (market) risk**\n\nA $\\beta = 1$ means the asset moves with the market. $\\beta > 1$ means more volatile than market."},{"category":"","text":"The GDP (Gross Domestic Product) expenditure formula is:","type":"single","answers":[{"text":"$GDP = C + I + G + (X - M)$","correct":true},{"text":"$GDP = C + I + G + X + M$","correct":false},{"text":"$GDP = C - I + G + X$","correct":false},{"text":"$GDP = C + I - G + M$","correct":false}],"reason":"GDP by expenditure approach:\n$$GDP = C + I + G + (X - M)$$\n\nWhere:\n- $C$ = Consumer spending\n- $I$ = Investment\n- $G$ = Government spending\n- $X$ = Exports\n- $M$ = Imports\n- $(X - M)$ = **Net exports**"}]};
    </script>

    <!-- Quiz application -->
    <script>
        
// Quiz Application
class QuizApp {
    constructor(quizData) {
        this.quizData = quizData;
        this.state = this.loadState() || this.initializeState();
        this.init();
    }

    // Initialize application
    init() {
        // Apply system dark mode preference on load
        if (this.state.config.darkMode) {
            document.documentElement.classList.add('dark');
        }

        // Render initial page
        this.render();
    }

    // Initialize default state
    initializeState() {
        return {
            currentPage: 'intro',
            currentQuestionIndex: 0,
            config: {
                shuffleQuestions: false,
                shuffleAnswers: false,
                autoAdvance: false,
                autoAdvanceDelay: 3,
                timerEnabled: false,
                timerMinutes: 90,
                boldQuestions: true,
                darkMode: this.detectDarkMode()
            },
            questions: this.prepareQuestions(),
            answers: {},
            checked: {},
            startTime: null,
            endTime: null,
            timerSeconds: null,
            timerInterval: null,
            timerPaused: false
        };
    }

    // Detect system dark mode preference
    detectDarkMode() {
        if (window.matchMedia) {
            return window.matchMedia('(prefers-color-scheme: dark)').matches;
        }
        return false;
    }

    // Prepare questions (with shuffling if configured)
    prepareQuestions() {
        let questions = [...this.quizData.questions];

        // Note: Shuffling will be applied when starting quiz from intro
        return questions.map((q, index) => ({
            ...q,
            originalIndex: index,
            answers: q.answers.map((a, i) => ({ ...a, originalIndex: i }))
        }));
    }

    // Apply shuffling based on config
    applyShuffling() {
        if (this.state.config.shuffleQuestions) {
            this.state.questions = this.shuffleArray(this.state.questions);
        }

        if (this.state.config.shuffleAnswers) {
            this.state.questions = this.state.questions.map(q => ({
                ...q,
                answers: this.shuffleArray([...q.answers])
            }));
        }
    }

    // Shuffle array (Fisher-Yates algorithm)
    shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    // State management
    saveState() {
        try {
            sessionStorage.setItem('quizState', JSON.stringify(this.state));
        } catch (e) {
            console.error('Failed to save state:', e);
        }
    }

    loadState() {
        try {
            const saved = sessionStorage.getItem('quizState');
            return saved ? JSON.parse(saved) : null;
        } catch (e) {
            console.error('Failed to load state:', e);
            return null;
        }
    }

    clearState() {
        try {
            sessionStorage.removeItem('quizState');
        } catch (e) {
            console.error('Failed to clear state:', e);
        }
    }

    // Navigation
    goToIntro() {
        this.state.currentPage = 'intro';
        this.saveState();
        this.render();
    }

    goToQuestion(index) {
        this.state.currentPage = 'question';
        this.state.currentQuestionIndex = index;
        this.saveState();
        this.render();
    }

    goToStatistics() {
        this.state.currentPage = 'statistics';
        this.state.endTime = Date.now();
        this.stopTimer();
        this.saveState();
        this.render();
    }

    finishQuiz() {
        // Called when time runs out - go to statistics
        this.goToStatistics();
    }

    goToReview(index) {
        this.state.currentPage = 'review';
        this.state.currentQuestionIndex = index;
        this.saveState();
        this.render();
    }

    nextQuestion() {
        if (this.state.currentQuestionIndex < this.state.questions.length - 1) {
            this.goToQuestion(this.state.currentQuestionIndex + 1);
        } else {
            this.goToStatistics();
        }
    }

    previousQuestion() {
        if (this.state.currentQuestionIndex > 0) {
            this.goToQuestion(this.state.currentQuestionIndex - 1);
        }
    }

    // Quiz logic
    startQuiz() {
        this.applyShuffling();
        this.state.startTime = Date.now();
        this.state.currentPage = 'question';
        this.state.currentQuestionIndex = 0;
        this.state.answers = {};
        this.state.checked = {};

        // Initialize timer if enabled
        if (this.state.config.timerEnabled) {
            this.state.timerSeconds = this.state.config.timerMinutes * 60;
            this.state.timerPaused = false;
            this.startTimer();
        }

        this.saveState();
        this.render();
    }

    // Timer methods
    startTimer() {
        if (this.state.timerInterval) {
            clearInterval(this.state.timerInterval);
        }

        this.state.timerInterval = setInterval(() => {
            if (!this.state.timerPaused && this.state.timerSeconds > 0) {
                this.state.timerSeconds--;
                this.updateTimerDisplay();

                if (this.state.timerSeconds === 0) {
                    this.handleTimeUp();
                }
            }
        }, 1000);
    }

    updateTimerDisplay() {
        // Update only the timer display without re-rendering the entire page
        const timerDisplay = document.getElementById('timer-display');
        if (timerDisplay) {
            timerDisplay.textContent = '‚è±Ô∏è ' + (this.state.timerPaused ? 'GEPAUZEERD' : this.formatTimerDisplay(this.state.timerSeconds));
            timerDisplay.className = 'text-lg font-mono font-bold ' + this.getTimerColorClass();
        }
    }

    pauseTimer() {
        this.state.timerPaused = true;
        this.saveState();
        this.render();
    }

    resumeTimer() {
        this.state.timerPaused = false;
        this.saveState();
        this.render();
    }

    stopTimer() {
        if (this.state.timerInterval) {
            clearInterval(this.state.timerInterval);
            this.state.timerInterval = null;
        }
    }

    handleTimeUp() {
        this.stopTimer();
        this.state.timerPaused = true;

        // Show modal
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white dark:bg-gray-800 rounded-lg p-8 max-w-md mx-4 shadow-2xl">
                <div class="text-center">
                    <div class="text-6xl mb-4">‚è∞</div>
                    <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">
                        Tijd is om!
                    </h2>
                    <p class="text-gray-600 dark:text-gray-300 mb-6">
                        De tijd voor deze quiz is verstreken.
                    </p>
                    <button id="time-up-ok"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg">
                        OK
                    </button>
                </div>
            </div>
        `;

        document.body.appendChild(modal);

        document.getElementById('time-up-ok').addEventListener('click', () => {
            document.body.removeChild(modal);
            this.finishQuiz();
        });
    }

    formatTimerDisplay(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;

        if (hours > 0) {
            return hours + ':' + minutes.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        } else {
            return minutes + ':' + secs.toString().padStart(2, '0');
        }
    }

    getTimerColorClass() {
        if (!this.state.config.timerEnabled) return '';
        if (this.state.timerSeconds > 300) return 'text-gray-700 dark:text-gray-300';
        if (this.state.timerSeconds > 60) return 'text-orange-600 dark:text-orange-400';
        return 'text-red-600 dark:text-red-400 animate-pulse';
    }

    selectAnswer(questionIndex, answerIndex, isMultiple) {
        if (this.state.checked[questionIndex]) {
            return; // Already checked, can't change
        }

        if (!this.state.answers[questionIndex]) {
            this.state.answers[questionIndex] = [];
        }

        if (isMultiple) {
            // Toggle checkbox
            const idx = this.state.answers[questionIndex].indexOf(answerIndex);
            if (idx > -1) {
                this.state.answers[questionIndex].splice(idx, 1);
            } else {
                this.state.answers[questionIndex].push(answerIndex);
            }
        } else {
            // Radio button - single selection
            this.state.answers[questionIndex] = [answerIndex];
        }

        this.saveState();
        this.render();
    }

    checkAnswer(questionIndex) {
        const selectedIndices = this.state.answers[questionIndex] || [];

        if (selectedIndices.length === 0) {
            alert('Selecteer eerst een antwoord');
            return;
        }

        this.state.checked[questionIndex] = true;
        this.saveState();
        this.render();
    }

    isAnswerCorrect(questionIndex) {
        const question = this.state.questions[questionIndex];
        const selectedIndices = this.state.answers[questionIndex] || [];
        const correctIndices = question.answers
            .map((a, i) => a.correct ? i : -1)
            .filter(i => i !== -1);

        if (selectedIndices.length !== correctIndices.length) {
            return false;
        }

        const sortedSelected = [...selectedIndices].sort();
        const sortedCorrect = [...correctIndices].sort();

        return sortedSelected.every((val, idx) => val === sortedCorrect[idx]);
    }

    calculateScore() {
        const total = this.state.questions.length;
        const answered = Object.keys(this.state.checked).length;
        const correct = Object.keys(this.state.checked)
            .filter(i => this.isAnswerCorrect(parseInt(i)))
            .length;

        return {
            total,
            answered,
            correct,
            percentage: total > 0 ? Math.round((correct / total) * 100) : 0
        };
    }

    getElapsedTime() {
        if (!this.state.startTime) return 0;
        const end = this.state.endTime || Date.now();
        return end - this.state.startTime;
    }

    formatTime(milliseconds) {
        const seconds = Math.floor(milliseconds / 1000);
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return minutes + ':' + remainingSeconds.toString().padStart(2, '0');
    }

    restartQuiz() {
        this.clearState();
        this.state = this.initializeState();
        this.saveState();
        this.render();
    }

    // Master render function
    render() {
        const app = document.getElementById('app');

        if (this.state.currentPage === 'intro') {
            app.innerHTML = this.renderIntro();
        } else if (this.state.currentPage === 'question') {
            app.innerHTML = this.renderQuestion(this.state.currentQuestionIndex);
        } else if (this.state.currentPage === 'statistics') {
            app.innerHTML = this.renderStatistics();
        } else if (this.state.currentPage === 'review') {
            app.innerHTML = this.renderReview(this.state.currentQuestionIndex);
        }

        // Attach event listeners after rendering
        this.attachEventListeners();

        // Render LaTeX formulas
        this.renderLatex();
    }

    // Render intro/config page
    renderIntro() {
        const questionCount = this.quizData.questions.length;

        return `
            <div class="max-w-2xl mx-auto">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
                    <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-4">
                        ${this.escapeHtml(this.quizData.title)}
                    </h1>

                    <p class="text-lg text-gray-600 dark:text-gray-400 mb-8">
                        Deze quiz bevat <strong>${questionCount}</strong> vragen.
                    </p>

                    <div class="space-y-4 mb-8">
                        <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4">
                            Instellingen
                        </h2>

                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox"
                                   id="shuffle-questions"
                                   ${this.state.config.shuffleQuestions ? 'checked' : ''}
                                   class="w-5 h-5 text-blue-600 rounded">
                            <span class="text-gray-700 dark:text-gray-300">
                                Vragen in willekeurige volgorde
                            </span>
                        </label>

                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox"
                                   id="shuffle-answers"
                                   ${this.state.config.shuffleAnswers ? 'checked' : ''}
                                   class="w-5 h-5 text-blue-600 rounded">
                            <span class="text-gray-700 dark:text-gray-300">
                                Antwoorden in willekeurige volgorde
                            </span>
                        </label>

                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox"
                                   id="auto-advance"
                                   ${this.state.config.autoAdvance ? 'checked' : ''}
                                   class="w-5 h-5 text-blue-600 rounded">
                            <span class="text-gray-700 dark:text-gray-300">
                                Automatisch naar volgende vraag (na
                                <input type="number"
                                       id="auto-advance-delay"
                                       min="1"
                                       max="10"
                                       value="${this.state.config.autoAdvanceDelay}"
                                       class="w-12 px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                seconden)
                            </span>
                        </label>

                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox"
                                   id="timer-enabled"
                                   ${this.state.config.timerEnabled ? 'checked' : ''}
                                   class="w-5 h-5 text-blue-600 rounded">
                            <span class="text-gray-700 dark:text-gray-300">
                                Tijdslimiet instellen (
                                <input type="number"
                                       id="timer-minutes"
                                       min="1"
                                       max="300"
                                       value="${this.state.config.timerMinutes}"
                                       class="w-16 px-2 py-1 text-center border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                minuten)
                            </span>
                        </label>

                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox"
                                   id="bold-questions"
                                   ${this.state.config.boldQuestions ? 'checked' : ''}
                                   class="w-5 h-5 text-blue-600 rounded">
                            <span class="text-gray-700 dark:text-gray-300">
                                Vraagtekst vetgedrukt weergeven
                            </span>
                        </label>
                    </div>

                    <button id="start-quiz"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl">
                        Start Quiz ‚Üí
                    </button>
                </div>
            </div>
        `;
    }

    // Render question page - CONTINUING IN NEXT PART...
    renderQuestion(index) {
        const question = this.state.questions[index];
        const isChecked = this.state.checked[index];
        const selectedIndices = this.state.answers[index] || [];
        const progress = ((index + 1) / this.state.questions.length) * 100;
        const isMultiple = question.type === 'multiple';

        let answersHtml = '';
        question.answers.forEach((answer, answerIndex) => {
            const isSelected = selectedIndices.includes(answerIndex);
            const isCorrect = answer.correct;

            let borderClass = 'border-gray-200 dark:border-gray-700';
            let bgClass = 'bg-white dark:bg-gray-800';
            let icon = '';

            if (isChecked) {
                if (isCorrect) {
                    borderClass = 'border-green-500';
                    bgClass = 'bg-green-50 dark:bg-green-900/20';
                    icon = '<span class="text-green-600 font-bold">‚úì</span>';
                } else if (isSelected) {
                    borderClass = 'border-red-500';
                    bgClass = 'bg-red-50 dark:bg-red-900/20';
                    icon = '<span class="text-red-600 font-bold">‚úó</span>';
                }
            } else if (isSelected) {
                borderClass = 'border-blue-500';
                bgClass = 'bg-blue-50 dark:bg-blue-900/20';
            }

            const inputType = isMultiple ? 'checkbox' : 'radio';
            const inputName = isMultiple ? '' : 'answer-' + index;

            answersHtml += `
                <div class="border-2 ${borderClass} ${bgClass} rounded-lg p-4 cursor-pointer hover:border-blue-400 transition-colors"
                     data-answer-index="${answerIndex}">
                    <label class="flex items-start cursor-pointer">
                        <input type="${inputType}"
                               ${inputName ? 'name="' + inputName + '"' : ''}
                               ${isSelected ? 'checked' : ''}
                               ${isChecked ? 'disabled' : ''}
                               class="w-5 h-5 text-blue-600 mr-3 mt-1 flex-shrink-0">
                        <div class="flex-1 text-gray-900 dark:text-gray-100 prose prose-sm dark:prose-invert max-w-none">
                            ${this.renderMarkdown(answer.text)}
                        </div>
                        ${icon}
                    </label>
                </div>
            `;
        });

        const reasonHtml = isChecked ? `
            <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 rounded">
                <div class="flex items-center mb-2">
                    <span class="text-2xl mr-2">üí°</span>
                    <span class="font-semibold text-blue-900 dark:text-blue-100">Uitleg</span>
                </div>
                <div class="text-gray-700 dark:text-gray-300 prose prose-sm dark:prose-invert max-w-none">
                    ${this.renderMarkdown(question.reason)}
                </div>
            </div>
        ` : '';

        const checkButton = isChecked
            ? '<button class="px-6 py-2 bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 rounded-lg cursor-not-allowed" disabled>Gecontroleerd ‚úì</button>'
            : '<button id="check-answer" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow">Controleren</button>';

        const isLastQuestion = index === this.state.questions.length - 1;
        const nextButton = isLastQuestion
            ? '<button id="submit-quiz" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow">Afronden ‚Üí</button>'
            : '<button id="next-question" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow">Volgende ‚Üí</button>';

        const backButton = index > 0
            ? '<button id="prev-question" class="px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold rounded-lg shadow hover:bg-gray-300 dark:hover:bg-gray-600">‚Üê Vorige</button>'
            : '';

        // Timer display (if enabled)
        const timerHtml = this.state.config.timerEnabled ? `
            <div class="flex items-center gap-3">
                <span id="timer-display" class="text-lg font-mono font-bold ${this.getTimerColorClass()}">
                    ‚è±Ô∏è ${this.state.timerPaused ? 'GEPAUZEERD' : this.formatTimerDisplay(this.state.timerSeconds)}
                </span>
                <button id="timer-toggle"
                        class="px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded font-semibold">
                    ${this.state.timerPaused ? '‚ñ∂Ô∏è Hervatten' : '‚è∏Ô∏è Pauzeren'}
                </button>
                <span class="text-gray-400">‚îÇ</span>
            </div>
        ` : '';

        return `
            <div>
                <!-- Progress bar -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-600 dark:text-gray-400">Voortgang</span>
                        <div class="flex items-center gap-2">
                            ` + timerHtml + `
                            <span class="text-sm font-semibold text-gray-900 dark:text-gray-100">
                                Vraag ` + (index + 1) + ` / ` + this.state.questions.length + `
                            </span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div class="progress-bar bg-blue-600 h-2 rounded-full"
                             style="width: ` + progress + `%"></div>
                    </div>
                </div>

                <!-- Question card -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
                    ${question.category ? `
                        <div class="inline-block px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm font-semibold rounded mb-4">
                            ${this.escapeHtml(question.category)}
                        </div>
                    ` : ''}

                    <div class="text-gray-900 dark:text-gray-100 mb-6 prose prose-lg dark:prose-invert max-w-none ${this.state.config.boldQuestions ? 'bold-questions' : ''}">
                        ${this.renderMarkdown(question.text)}
                    </div>

                    <div class="space-y-3 mb-6" id="answers-container">
                        ${answersHtml}
                    </div>

                    ${reasonHtml}
                </div>

                <!-- Navigation -->
                <div class="flex justify-between items-center mt-6">
                    <div>
                        ${backButton}
                    </div>
                    <div class="flex gap-3">
                        ${checkButton}
                        ${nextButton}
                    </div>
                </div>
            </div>
        `;
    }

    // Render statistics page - CONTINUING...
    renderStatistics() {
        const score = this.calculateScore();
        const timeElapsed = this.formatTime(this.getElapsedTime());

        let questionsList = '';
        this.state.questions.forEach((question, index) => {
            const isCorrect = this.isAnswerCorrect(index);
            const icon = isCorrect
                ? '<span class="text-green-600 text-xl">‚úì</span>'
                : '<span class="text-red-600 text-xl">‚úó</span>';

            const shortText = question.text.length > 60
                ? question.text.substring(0, 60) + '...'
                : question.text;

            questionsList += `
                <div class="flex items-center p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer"
                     data-review-index="${index}">
                    <span class="mr-3">${icon}</span>
                    <span class="flex-1 text-gray-700 dark:text-gray-300">
                        ${index + 1}. ${this.escapeHtml(shortText)}
                    </span>
                </div>
            `;
        });

        return `
            <div class="max-w-4xl mx-auto">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-2">
                            Resultaten Analyse
                        </h1>
                        <p class="text-gray-600 dark:text-gray-400">
                            ${this.escapeHtml(this.quizData.title)}
                        </p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8 mb-8">
                        <!-- Score circle -->
                        <div class="flex flex-col items-center justify-center">
                            <div class="relative w-48 h-48">
                                <svg class="transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="10"
                                            class="text-gray-200 dark:text-gray-700" />
                                    <circle cx="50" cy="50" r="45"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="10"
                                            stroke-dasharray="${score.percentage * 2.827}, 282.7"
                                            class="${score.percentage >= 75 ? 'text-green-500' : score.percentage >= 50 ? 'text-yellow-500' : 'text-red-500'}"
                                            stroke-linecap="round" />
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-4xl font-bold text-gray-900 dark:text-gray-100">
                                        ${score.percentage}%
                                    </span>
                                </div>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mt-4">Eindscore</p>
                        </div>

                        <!-- Stats -->
                        <div class="flex flex-col justify-center space-y-4">
                            <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <span class="text-gray-600 dark:text-gray-400">Score:</span>
                                <span class="text-xl font-semibold text-gray-900 dark:text-gray-100">
                                    ${score.correct} / ${score.total}
                                </span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <span class="text-gray-600 dark:text-gray-400">Tijd:</span>
                                <span class="text-xl font-semibold text-gray-900 dark:text-gray-100">
                                    ${timeElapsed}
                                </span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <span class="text-gray-600 dark:text-gray-400">Status:</span>
                                <span class="text-xl font-semibold ${score.percentage >= 75 ? 'text-green-600' : score.percentage >= 50 ? 'text-yellow-600' : 'text-red-600'}">
                                    ${score.percentage >= 75 ? 'Geslaagd ‚úì' : score.percentage >= 50 ? 'Voldoende' : 'Onvoldoende'}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Questions review list -->
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4">
                            Vraag overzicht
                        </h2>
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden" id="questions-review">
                            ${questionsList}
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="flex justify-between items-center mt-8">
                        <button id="back-to-last"
                                class="px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold rounded-lg shadow hover:bg-gray-300 dark:hover:bg-gray-600">
                            ‚Üê Terug
                        </button>
                        <button id="restart-quiz"
                                class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow">
                            üîÑ Opnieuw starten
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    // Render review page
    renderReview(index) {
        // Similar to renderQuestion but read-only
        const question = this.state.questions[index];
        const selectedIndices = this.state.answers[index] || [];
        const isCorrect = this.isAnswerCorrect(index);

        let answersHtml = '';
        question.answers.forEach((answer, answerIndex) => {
            const isSelected = selectedIndices.includes(answerIndex);
            const isAnswerCorrect = answer.correct;

            let borderClass = 'border-gray-200 dark:border-gray-700';
            let bgClass = 'bg-white dark:bg-gray-800';
            let icon = '';

            if (isAnswerCorrect) {
                borderClass = 'border-green-500';
                bgClass = 'bg-green-50 dark:bg-green-900/20';
                icon = '<span class="text-green-600 font-bold">‚úì</span>';
            } else if (isSelected) {
                borderClass = 'border-red-500';
                bgClass = 'bg-red-50 dark:bg-red-900/20';
                icon = '<span class="text-red-600 font-bold">‚úó</span>';
            }

            answersHtml += `
                <div class="border-2 ${borderClass} ${bgClass} rounded-lg p-4">
                    <div class="flex items-start">
                        <div class="flex-1 text-gray-900 dark:text-gray-100 prose prose-sm dark:prose-invert max-w-none">
                            ${this.renderMarkdown(answer.text)}
                        </div>
                        ${icon}
                    </div>
                </div>
            `;
        });

        return `
            <div>
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
                    <div class="flex items-center justify-between mb-6">
                        ${question.category ? `
                            <div class="inline-block px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm font-semibold rounded">
                                ${this.escapeHtml(question.category)}
                            </div>
                        ` : '<div></div>'}

                        <span class="text-sm font-semibold ${isCorrect ? 'text-green-600' : 'text-red-600'}">
                            ${isCorrect ? 'Correct ‚úì' : 'Incorrect ‚úó'}
                        </span>
                    </div>

                    <div class="text-gray-900 dark:text-gray-100 mb-6 prose prose-lg dark:prose-invert max-w-none ${this.state.config.boldQuestions ? 'bold-questions' : ''}">
                        ${this.renderMarkdown(question.text)}
                    </div>

                    <div class="space-y-3 mb-6">
                        ${answersHtml}
                    </div>

                    <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 rounded">
                        <div class="flex items-center mb-2">
                            <span class="text-2xl mr-2">üí°</span>
                            <span class="font-semibold text-blue-900 dark:text-blue-100">Uitleg</span>
                        </div>
                        <div class="text-gray-700 dark:text-gray-300 prose prose-sm dark:prose-invert max-w-none">
                            ${this.renderMarkdown(question.reason)}
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="back-to-statistics"
                            class="px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold rounded-lg shadow hover:bg-gray-300 dark:hover:bg-gray-600">
                        ‚Üê Terug naar resultaten
                    </button>
                </div>
            </div>
        `;
    }

    // Attach event listeners after rendering
    attachEventListeners() {
        // Intro page
        const startButton = document.getElementById('start-quiz');
        if (startButton) {
            startButton.addEventListener('click', () => {
                // Save config
                this.state.config.shuffleQuestions = document.getElementById('shuffle-questions').checked;
                this.state.config.shuffleAnswers = document.getElementById('shuffle-answers').checked;
                this.state.config.autoAdvance = document.getElementById('auto-advance').checked;
                this.state.config.autoAdvanceDelay = parseInt(document.getElementById('auto-advance-delay').value);
                this.state.config.timerEnabled = document.getElementById('timer-enabled').checked;
                this.state.config.timerMinutes = parseInt(document.getElementById('timer-minutes').value);
                this.state.config.boldQuestions = document.getElementById('bold-questions').checked;
                this.startQuiz();
            });
        }

        // Timer pause/resume toggle
        const timerToggle = document.getElementById('timer-toggle');
        if (timerToggle) {
            timerToggle.addEventListener('click', () => {
                if (this.state.timerPaused) {
                    this.resumeTimer();
                } else {
                    this.pauseTimer();
                }
            });
        }

        // Question page - answer selection
        const answersContainer = document.getElementById('answers-container');
        if (answersContainer) {
            const question = this.state.questions[this.state.currentQuestionIndex];
            const isMultiple = question.type === 'multiple';

            answersContainer.querySelectorAll('[data-answer-index]').forEach(div => {
                div.addEventListener('click', () => {
                    const answerIndex = parseInt(div.dataset.answerIndex);
                    this.selectAnswer(this.state.currentQuestionIndex, answerIndex, isMultiple);
                });
            });
        }

        // Check answer button
        const checkButton = document.getElementById('check-answer');
        if (checkButton) {
            checkButton.addEventListener('click', () => {
                this.checkAnswer(this.state.currentQuestionIndex);
            });
        }

        // Navigation buttons
        const nextButton = document.getElementById('next-question');
        if (nextButton) {
            nextButton.addEventListener('click', () => this.nextQuestion());
        }

        const prevButton = document.getElementById('prev-question');
        if (prevButton) {
            prevButton.addEventListener('click', () => this.previousQuestion());
        }

        const submitButton = document.getElementById('submit-quiz');
        if (submitButton) {
            submitButton.addEventListener('click', () => this.goToStatistics());
        }

        // Statistics page
        const restartButton = document.getElementById('restart-quiz');
        if (restartButton) {
            restartButton.addEventListener('click', () => {
                if (confirm('Weet je zeker dat je de quiz opnieuw wilt starten? Je huidige voortgang gaat verloren.')) {
                    this.restartQuiz();
                }
            });
        }

        const backToLastButton = document.getElementById('back-to-last');
        if (backToLastButton) {
            backToLastButton.addEventListener('click', () => {
                this.goToQuestion(this.state.questions.length - 1);
            });
        }

        // Review question clicks
        const reviewContainer = document.getElementById('questions-review');
        if (reviewContainer) {
            reviewContainer.querySelectorAll('[data-review-index]').forEach(div => {
                div.addEventListener('click', () => {
                    const index = parseInt(div.dataset.reviewIndex);
                    this.goToReview(index);
                });
            });
        }

        // Back to statistics from review
        const backToStatsButton = document.getElementById('back-to-statistics');
        if (backToStatsButton) {
            backToStatsButton.addEventListener('click', () => {
                this.goToStatistics();
            });
        }
    }

    // Utility: Escape HTML
    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // Utility: Render Markdown
    renderMarkdown(text) {
        if (typeof marked !== 'undefined') {
            return marked.parse(text);
        }
        // Fallback to escaped HTML if marked.js not loaded
        return this.escapeHtml(text);
    }

    // Utility: Render LaTeX math formulas
    renderLatex() {
        if (typeof renderMathInElement !== 'undefined') {
            const app = document.getElementById('app');
            renderMathInElement(app, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError: false,
                ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option']
            });
        }
    }
}

// Configure marked.js with highlight.js for syntax highlighting
if (typeof marked !== 'undefined') {
    const renderer = new marked.Renderer();

    // Custom code renderer for syntax highlighting
    if (typeof hljs !== 'undefined') {
        renderer.code = function(code, language) {
            // Handle marked v11+ object format
            if (typeof code === 'object') {
                language = code.lang;
                code = code.text;
            }
            const validLang = language && hljs.getLanguage(language);
            const highlighted = validLang
                ? hljs.highlight(code, { language: language }).value
                : hljs.highlightAuto(code).value;
            return '<pre><code class="hljs ' + (language || '') + '">' + highlighted + '</code></pre>';
        };
    }

    marked.setOptions({
        renderer: renderer,
        breaks: true,  // Convert single newlines to <br>
        gfm: true      // GitHub Flavored Markdown
    });
}

// Initialize the quiz application
const quizApp = new QuizApp(QUIZ_DATA);

    </script>
</body>
</html>